import{k as N,t as M,r,j as s,B as i,A as j,T as d,I as b,q as S,h as W,p as l,aS as H,aT as Y,H as D,C as U}from"./index-BtB7UOt2.js";import{u as q,L as z,z as w,t as G}from"./zod-DAAV14pM.js";import{T as k}from"./TextField-DxmO3TN0.js";import{I as v}from"./InputAdornment-BvyjvqD-.js";import"./CircularProgress-Dtxp3OJV.js";import"./Select-BfbTOkoI.js";import"./isMuiElement-B37rc9mm.js";import"./formControlState-Dq1zat_P.js";const O=w.object({newPassword:w.string().min(8,{message:"Password must be at least 8 characters long!"}),confirmPassword:w.string().min(8,{message:"Password must be at least 8 characters long!"})}).refine(t=>t.newPassword===t.confirmPassword,{path:["confirmPassword"],message:"Passwords must match!"});function $(){var x,P;const t=N(),I=M(),[h,o]=r.useState(""),[p,T]=r.useState(""),[R,V]=r.useState(!1),[K,A]=r.useState(!1),[Q,g]=r.useState(!0),[c,C]=r.useState(!1),[u,B]=r.useState(!1),m=I.get("token"),{register:f,handleSubmit:L,formState:{errors:n,isSubmitting:E}}=q({resolver:G(O),defaultValues:{newPassword:"",confirmPassword:""}});r.useEffect(()=>{(async()=>{if(!m){o("No token provided"),g(!1);return}try{const e=await H(m);console.log("Token Validation Response:",e),e.status==="success"?A(!0):(o(e.message||"Invalid or expired reset token."),t.push(l.page404))}catch(e){console.error("Validation Error:",e),o(e.message||"An error occurred while validating the token."),t.push(l.page404)}finally{g(!1)}})()},[m,t]);const F=async y=>{const e=new URLSearchParams(window.location.search).get("token");try{const a=await Y({resetToken:e,newPassword:y.newPassword});console.log(a),T("Password Updated Successfully"),V(!0)}catch(a){console.error("Password reset failed:",a),o(a.message||"An error occurred while resetting the password")}};return s.jsxs(i,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"70vh",padding:3,children:[!!h&&s.jsx(j,{severity:"error",sx:{mb:3},children:h}),!!p&&s.jsx(j,{severity:"success",sx:{mb:3},children:p}),R?s.jsxs(i,{textAlign:"center",children:[s.jsx(d,{variant:"h6",gutterBottom:!0,children:"Password successfully reset!"}),s.jsx(d,{variant:"body2",mb:2,children:"Your password has been reset successfully. You can now sign in with your new password."}),s.jsx(W,{href:l.auth.signIn,underline:"none",onClick:()=>t.push(l.auth.signIn),variant:"body2",color:"primary",children:"Return to Sign In"})]}):s.jsxs(s.Fragment,{children:[s.jsxs(i,{textAlign:"center",mb:4,children:[s.jsx(d,{variant:"h4",gutterBottom:!0,children:"Reset Your Password"}),s.jsx(d,{variant:"body2",children:"Please enter your new password and confirm it to reset your password."})]}),s.jsxs(i,{component:"form",onSubmit:L(F),display:"flex",flexDirection:"column",gap:3,width:"100%",maxWidth:400,children:[s.jsx(k,{label:"New Password",type:c?"text":"password",...f("newPassword"),error:!!n.newPassword,helperText:(x=n.newPassword)==null?void 0:x.message,fullWidth:!0,InputProps:{endAdornment:s.jsx(v,{position:"end",children:s.jsx(b,{onClick:()=>C(!c),edge:"end",children:s.jsx(S,{icon:c?"solar:eye-bold":"solar:eye-closed-bold"})})})}}),s.jsx(k,{label:"Confirm Password",type:u?"text":"password",...f("confirmPassword"),error:!!n.confirmPassword,helperText:(P=n.confirmPassword)==null?void 0:P.message,fullWidth:!0,InputProps:{endAdornment:s.jsx(v,{position:"end",children:s.jsx(b,{onClick:()=>B(!u),edge:"end",children:s.jsx(S,{icon:u?"solar:eye-bold":"solar:eye-closed-bold"})})})}}),s.jsx(z,{type:"submit",variant:"contained",loading:E,fullWidth:!0,children:"Submit"})]})]})]})}const J={title:`Reset Password | ${U.appName}`};function ns(){return s.jsxs(s.Fragment,{children:[s.jsx(D,{children:s.jsxs("title",{children:[" ",J.title]})}),s.jsx($,{})]})}export{ns as default};
