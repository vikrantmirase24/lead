import{r as s,k as N,t as q,v as g,p as S,w as U,x as H,j as e,B as u,T as h,A as k,c as P,H as L,C as W}from"./index-BtB7UOt2.js";import{z as V,u as $,t as G,L as _}from"./zod-DAAV14pM.js";import{F as J,a as K}from"./form-provider-CuVxRMWy.js";import"./image-BYwoUYoH.js";import{C as w}from"./CircularProgress-Dtxp3OJV.js";import"./TextField-DxmO3TN0.js";import"./Select-BfbTOkoI.js";import"./isMuiElement-B37rc9mm.js";import"./formControlState-Dq1zat_P.js";import"./DatePicker-D1byhs5K.js";import"./InputAdornment-BvyjvqD-.js";import"./Dialog-DBgaWhmn.js";import"./RadioGroup-DtZ99t_7.js";import"./FormControlLabel-BSJAInse.js";import"./KeyboardArrowRight-CNgXDUW1.js";function Q(a){const[n,r]=s.useState(a),[c,d]=s.useState(!1),t=s.useCallback(()=>{d(!0)},[]),p=s.useCallback(()=>{d(!1),r(a)},[a]);return s.useEffect(()=>{let i=null;return c&&n>0?i=setInterval(()=>{r(f=>f-1)},1e3):n<=0&&d(!1),()=>{i&&clearInterval(i)}},[c,n]),{value:n,setValue:r,isCounting:c,start:t,reset:p}}const X=V.object({code:V.string().min(1,{message:"Code is required!"}).min(6,{message:"Code must be at least 6 characters!"})});function Y(){const a=N(),n=q(),r=g(n.get("user")),c=g(n.get("portal")),d=g(n.get("request_id")),t=Q(30),[p,i]=s.useState(""),[f,b]=s.useState(""),B={code:"",userId:r,portalId:3},[E,F]=s.useState(100),[R,v]=s.useState(!0),[A,y]=s.useState(!0);s.useEffect(()=>{(!r||!c)&&a.push(S.auth.signIn),t.start();const o=setInterval(()=>{const x=t.value/30*100;F(x),t.value<=0?(v(!1),y(!0)):y(!1)},1e3);return()=>clearInterval(o)},[t,t.value,r,c,a]);const j=$({resolver:G(X),defaultValues:B}),{handleSubmit:M,formState:{isSubmitting:T}}=j,z=M(async o=>{var x,C,I;try{await U({userId:r,portalId:3,otpCode:o.code,requestId:d}),a.refresh()}catch(l){const O=(x=l==null?void 0:l.response)==null?void 0:x.status;let m="";switch(O){case 400:m="Invalid or expired OTP.";break;case 404:m="User not found.";break;case 500:m="Internal Server Error. Please try again.";break;default:m=((I=(C=l==null?void 0:l.response)==null?void 0:C.data)==null?void 0:I.message)||"Invalid or expired OTP. Please try again.";break}console.error("Error confirming sign-up:",l),i(m),setTimeout(()=>{i("")},3e3)}}),D=s.useCallback(async()=>{if(t.value<=0){v(!0);try{t.reset(),t.start(),await H({userId:r}),b("Otp sent successfully"),setTimeout(()=>{b("")},3e3)}catch(o){console.error("Error resending sign-up code:",o),i(typeof o=="string"?o:o.message)}}},[t,r]);return e.jsxs(e.Fragment,{children:[e.jsxs(u,{textAlign:"center",mb:3,children:[e.jsxs(u,{sx:{position:"relative",display:"inline-flex",mb:2},children:[e.jsx(w,{variant:"determinate",value:100,size:200,thickness:8,sx:{color:"#d3d3d3"}}),e.jsx(w,{variant:"determinate",value:E,size:200,thickness:8,sx:{color:t.value>0?"#4caf50":"#90ee90",position:"absolute",left:0}}),e.jsx(u,{sx:{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(h,{variant:"caption",component:"div",color:"text.secondary",children:`${Math.round(t.value)}s`})})]}),e.jsx(h,{variant:"h5",mb:1,children:"2 Factor Authentication"}),e.jsxs(h,{variant:"body2",color:"text.secondary",children:["Weâ€™ve SMS or emailed a 6-digit confirmation code.",e.jsx("br",{}),"Please enter the code in the box below to verify your mobile number or email id."]})]}),!!f&&e.jsx(k,{severity:"success",sx:{mb:3},children:f}),!!p&&e.jsx(k,{severity:"error",sx:{mb:3},children:p}),e.jsx(J,{methods:j,onSubmit:z,children:e.jsxs(u,{gap:3,display:"flex",flexDirection:"column",children:[e.jsx(K.Code,{name:"code"}),e.jsx(_,{fullWidth:!0,size:"large",type:"submit",variant:"contained",disabled:A,loading:T,loadingIndicator:"Verify...",children:"Verify"})]})}),e.jsx(u,{mt:2,textAlign:"center",children:e.jsx(P,{variant:"outlined",size:"small",disabled:R,onClick:D,children:"Resend Code"})}),e.jsx(u,{mt:3,textAlign:"center",children:e.jsx(P,{variant:"text",onClick:()=>a.push(S.auth.signIn),children:"Return to Sign In"})})]})}const Z={title:`Verify otp | ${W.appName}`};function xe(){return e.jsxs(e.Fragment,{children:[e.jsx(L,{children:e.jsxs("title",{children:[" ",Z.title]})}),e.jsx(Y,{})]})}export{xe as default};
